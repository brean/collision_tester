var Ae=Object.defineProperty;var q=t=>{throw TypeError(t)};var Ce=(t,e,r)=>e in t?Ae(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var y=(t,e,r)=>Ce(t,typeof e!="symbol"?e+"":e,r),ee=(t,e,r)=>e.has(t)||q("Cannot "+r);var L=(t,e,r)=>(ee(t,e,"read from private field"),r?r.call(t):e.get(t)),te=(t,e,r)=>e.has(t)?q("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),re=(t,e,r,s)=>(ee(t,e,"write to private field"),s?s.call(t,r):e.set(t,r),r);import{t as ge,a as se}from"../chunks/DuRY85xG.js";import{x as ae,y as ne,A as Le,B as Te,an as Ne,ao as Re,ap as Be,h as B,aq as De,ar as He,as as Ue,g as je,t as Je,Z as ye,ac as R,ak as me,ab as Ve,P as We,u as Fe,f as Ge,a4 as d,a1 as Ye,Q as $e,a2 as ie,a3 as oe,at as Ke}from"../chunks/CYGJYrKH.js";import{d as Qe,s as ce}from"../chunks/Dfdn6VkB.js";import{b as le,i as Xe}from"../chunks/CstHgugv.js";let he=!1;function xe(){he||(he=!0,document.addEventListener("reset",t=>{Promise.resolve().then(()=>{var e;if(!t.defaultPrevented)for(const r of t.target.elements)(e=r.__on_r)==null||e.call(r)})},{capture:!0}))}function Ze(t){var e=Le,r=Te;ae(null),ne(null);try{return t()}finally{ae(e),ne(r)}}function ze(t,e,r,s=r){t.addEventListener(e,()=>Ze(r));const a=t.__on_r;a?t.__on_r=()=>{a(),s(!0)}:t.__on_r=()=>s(!0),xe()}const Oe=Symbol("is custom element"),qe=Symbol("is html");function fe(t){if(B){var e=!1,r=()=>{if(!e){if(e=!0,t.hasAttribute("value")){var s=t.value;g(t,"value",null),t.value=s}if(t.hasAttribute("checked")){var a=t.checked;g(t,"checked",null),t.checked=a}}};t.__on_r=r,He(r),xe()}}function g(t,e,r,s){var a=et(t);B&&(a[e]=t.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&t.nodeName==="LINK")||a[e]!==(a[e]=r)&&(e==="loading"&&(t[Ne]=r),r==null?t.removeAttribute(e):typeof r!="string"&&tt(t).includes(e)?t[e]=r:t.setAttribute(e,r))}function et(t){return t.__attributes??(t.__attributes={[Oe]:t.nodeName.includes("-"),[qe]:t.namespaceURI===Re})}var ue=new Map;function tt(t){var e=ue.get(t.nodeName);if(e)return e;ue.set(t.nodeName,e=[]);for(var r,s=t,a=Element.prototype;a!==s;){r=De(s);for(var n in r)r[n].set&&e.push(n);s=Be(s)}return e}function de(t,e,r=e){var s=Ue();ze(t,"input",a=>{var n=a?t.defaultValue:t.value;if(n=T(t)?N(n):n,r(n),s&&n!==(n=e())){var c=t.selectionStart,o=t.selectionEnd;t.value=n??"",o!==null&&(t.selectionStart=c,t.selectionEnd=Math.min(o,t.value.length))}}),(B&&t.defaultValue!==t.value||je(e)==null&&t.value)&&r(T(t)?N(t.value):t.value),Je(()=>{var a=e();T(t)&&a===N(t.value)||t.type==="date"&&!a&&!t.value||a!==t.value&&(t.value=a??"")})}function T(t){var e=t.type;return e==="number"||e==="range"}function N(t){return t===""?null:+t}const rt=100;var b;class ve{constructor(e){te(this,b);y(this,"color");y(this,"x");y(this,"y");y(this,"length");y(this,"child");this.color=e.color||"green",this.x=e.x||0,this.y=e.y||0,this.child=e.child,this.length=e.length||rt,re(this,b,me(Ve(e.angle||Math.PI/4)))}get angle(){return ye(L(this,b))}set angle(e){R(L(this,b),e,!0)}getEndPosition(){const e=this.x+this.length*Math.cos(this.angle),r=this.y-this.length*Math.sin(this.angle);return{x:e,y:r}}draw(e,r,s){this.x=e,this.y=r;const a=this.getEndPosition();s.lineWidth=3,s.beginPath(),s.moveTo(this.x,this.y),s.lineTo(a.x,a.y),s.stroke(),s.beginPath(),s.arc((this.x+a.x)/2,(this.y+a.y)/2,10,0,Math.PI*2),s.fillStyle=this.color,s.fill(),s.beginPath(),s.arc(a.x,a.y,5,0,Math.PI*2),s.fillStyle="black",s.fill(),this.child&&this.child.draw(a.x,a.y,s)}arcPos(){const e=this.getEndPosition();return{x:(this.x+e.x)/2,y:(this.y+e.y)/2}}isInsideJoint(e){const r=this.arcPos(),s=e.x-r.x,a=e.y-r.y;return s*s+a*a<=10*10}}b=new WeakMap;function _e(t,e){const r=t.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top}}function w(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function E(t,e,r){const s=(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y);return s===0?0:s>0?1:2}function st(t,e,r,s){const a=E(t,e,r),n=E(t,e,s),c=E(r,s,t),o=E(r,s,e);return!!(a!==0&&n!==0&&c!==0&&o!==0&&a!==n&&c!==o||a===0&&w(t,r,e)||n===0&&w(t,s,e)||c===0&&w(r,t,s)||o===0&&w(r,e,s))}class at{constructor(e){y(this,"vertices");this.vertices=e}draw(e,r,s){s.fillStyle="gray",s.beginPath(),s.moveTo(this.vertices[0].x+e,this.vertices[0].y+r);for(let a=1;a<this.vertices.length;a++)s.lineTo(this.vertices[a].x+e,this.vertices[a].y+r);s.closePath(),s.fill()}pointInside(e,r,s){let a=!1;for(let n=0,c=this.vertices.length-1;n<this.vertices.length;c=n++){const o=this.vertices[n].x+r,v=this.vertices[n].y+s,m=this.vertices[c].x+r,P=this.vertices[c].y+s;v>e.y!=P>e.y&&e.x<(m-o)*(e.y-v)/(P-v)+o&&(a=!a)}return a}collidesWithSegment(e,r,s,a){const n=this.vertices.map(o=>({x:o.x+s,y:o.y+a}));if(n.length<2)return!1;for(let o=0;o<n.length;o++){const v=n[o],m=n[(o+1)%n.length];if(st(e,r,v,m))return!0}const c={x:(e.x+r.x)/2,y:(e.y+r.y)/2};return!!(this.vertices.length>=3&&this.pointInside(c,s,a))}}var nt=ge('<div class="cspace_calc svelte-1b9rm3r">calculating C-Space...</div>'),it=ge('<div class="some_space svelte-1b9rm3r" style="margin-right: 20px;">Robot space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas></div> <div class="some_space svelte-1b9rm3r">configuration space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas> <!></div> <br> upper arm angle: <input type="range"> <button>0</button> <br> forearm angle: <input type="range"> <button>0</button> <br>',1);function ut(t,e){We(e,!0);let r,s,a,n,c,o=null,v=me(!0),m=!0,P=!1,h=new ve({length:80}),f=new ve({child:h,color:"blue"}),D=[new at([{x:20,y:20},{x:80,y:50},{x:50,y:80}])];function Me(){!h||!f||!n||(n.clearRect(0,0,a.width,a.height),o&&n.putImageData(o,0,0),n.beginPath(),n.arc((f.angle+Math.PI)*a.width/(Math.PI*2),(h.angle+Math.PI)*a.height/(Math.PI*2),4,0,Math.PI*2),n.fillStyle="rgba(0,0,0,0)",n.strokeStyle="black",n.lineWidth=2,n.fill(),n.stroke())}function H(){s&&(s.clearRect(0,0,r.width,r.height),D.forEach(i=>{s&&i.draw(r.width/2,r.height/2,s)}),f.draw(r.width/2,r.height/2,s),Me())}function be(){if(!n||!m)return;console.log("Computing c-space obstacles..."),R(v,!0);const i=a.width,l=a.height;o=n.createImageData(i,l);const u=o.data,p=r.width/2,F=r.height/2,G=f.length,Y=h.length,$=r.width/2,K=r.height/2;for(let I=0;I<l;I++){const Q=I/l*(2*Math.PI)-Math.PI;for(let S=0;S<i;S++){const X=S/i*(2*Math.PI)-Math.PI,Ee={x:p,y:F},Z={x:p+G*Math.cos(X),y:F-G*Math.sin(X)},C=Z,ke={x:C.x+Y*Math.cos(Q),y:C.y-Y*Math.sin(Q)};let z=!1;for(const O of D)if(O.collidesWithSegment(Ee,Z,$,K)||O.collidesWithSegment(C,ke,$,K)){z=!0;break}const _=(I*i+S)*4;z?(u[_]=255,u[_+1]=100,u[_+2]=100,u[_+3]=200):(u[_]=0,u[_+1]=0,u[_+2]=0,u[_+3]=0)}}console.log("c-space obstacles done."),m=R(v,!1)}function Pe(){if(!(!a||!r)){if(s=r.getContext("2d"),n=a.getContext("2d"),!n||!s){console.error("Failed to get canvas contexts.");return}be(),P||(r.addEventListener("pointerdown",i=>{const l=_e(r,i);h.isInsideJoint(l)?c=h:f.isInsideJoint(l)&&(c=f)}),r.addEventListener("pointerup",()=>{c=void 0}),r.addEventListener("pointermove",i=>{if(c){const l=_e(r,i),u=l.x-c.x,p=l.y-c.y;c.angle=Math.atan2(-p,u),H()}}),P=!0),H()}}Fe(Pe);var U=it(),k=Ge(U),pe=d(ie(k),3);le(pe,i=>r=i,()=>r),oe(k);var A=d(k,2),j=d(ie(A),3);le(j,i=>a=i,()=>a);var Ie=d(j,2);{var Se=i=>{var l=nt();se(i,l)};Xe(Ie,i=>{ye(v)&&i(Se)})}oe(A);var x=d(A,4);fe(x),g(x,"min",-Math.PI),g(x,"max",Math.PI),g(x,"step",.01);var J=d(x,2);J.__click=()=>{h.angle=0};var V=d(J),M=d(V,3);fe(M),g(M,"min",-Math.PI),g(M,"max",Math.PI),g(M,"step",.01);var W=d(M,2);W.__click=()=>{f.angle=0};var we=d(W);Ke(),Ye((i,l)=>{ce(V,` ${i??""}`),ce(we,` ${l??""}`)},[()=>Math.round(h.angle*1800/Math.PI)/10,()=>Math.round(f.angle*1800/Math.PI)/10]),de(x,()=>h.angle,i=>h.angle=i),de(M,()=>f.angle,i=>f.angle=i),se(t,U),$e()}Qe(["click"]);export{ut as component};
