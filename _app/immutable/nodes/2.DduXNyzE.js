var Ae=Object.defineProperty;var se=r=>{throw TypeError(r)};var Le=(r,e,t)=>e in r?Ae(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var P=(r,e,t)=>Le(r,typeof e!="symbol"?e+"":e,t),ne=(r,e,t)=>e.has(r)||se("Cannot "+t);var X=(r,e,t)=>(ne(r,e,"read from private field"),t?t.call(r):e.get(r)),ae=(r,e,t)=>e.has(r)?se("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ie=(r,e,t,s)=>(ne(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);import{t as me,a as oe}from"../chunks/DuRY85xG.js";import{x as ce,y as le,A as Te,B as Ne,an as Re,ao as Ve,ap as We,h as O,aq as Ye,ar as He,as as Xe,g as Be,t as De,Z as b,ac as C,ak as J,ab as Ue,P as je,u as Je,f as Oe,a4 as y,a1 as Fe,Q as Ge,a2 as he,a3 as fe,at as $e}from"../chunks/CYGJYrKH.js";import{d as Ke,s as de}from"../chunks/Dfdn6VkB.js";import{b as ue,i as Qe}from"../chunks/CstHgugv.js";let ve=!1;function be(){ve||(ve=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var e;if(!r.defaultPrevented)for(const t of r.target.elements)(e=t.__on_r)==null||e.call(t)})},{capture:!0}))}function Ze(r){var e=Te,t=Ne;ce(null),le(null);try{return r()}finally{ce(e),le(t)}}function ze(r,e,t,s=t){r.addEventListener(e,()=>Ze(t));const n=r.__on_r;n?r.__on_r=()=>{n(),s(!0)}:r.__on_r=()=>s(!0),be()}const qe=Symbol("is custom element"),et=Symbol("is html");function ge(r){if(O){var e=!1,t=()=>{if(!e){if(e=!0,r.hasAttribute("value")){var s=r.value;I(r,"value",null),r.value=s}if(r.hasAttribute("checked")){var n=r.checked;I(r,"checked",null),r.checked=n}}};r.__on_r=t,He(t),be()}}function I(r,e,t,s){var n=tt(r);O&&(n[e]=r.getAttribute(e),e==="src"||e==="srcset"||e==="href"&&r.nodeName==="LINK")||n[e]!==(n[e]=t)&&(e==="loading"&&(r[Re]=t),t==null?r.removeAttribute(e):typeof t!="string"&&rt(r).includes(e)?r[e]=t:r.setAttribute(e,t))}function tt(r){return r.__attributes??(r.__attributes={[qe]:r.nodeName.includes("-"),[et]:r.namespaceURI===Ve})}var _e=new Map;function rt(r){var e=_e.get(r.nodeName);if(e)return e;_e.set(r.nodeName,e=[]);for(var t,s=r,n=Element.prototype;n!==s;){t=Ye(s);for(var a in t)t[a].set&&e.push(a);s=We(s)}return e}function ye(r,e,t=e){var s=Xe();ze(r,"input",n=>{var a=n?r.defaultValue:r.value;if(a=B(r)?D(a):a,t(a),s&&a!==(a=e())){var i=r.selectionStart,c=r.selectionEnd;r.value=a??"",c!==null&&(r.selectionStart=i,r.selectionEnd=Math.min(c,r.value.length))}}),(O&&r.defaultValue!==r.value||Be(e)==null&&r.value)&&t(B(r)?D(r.value):r.value),De(()=>{var n=e();B(r)&&n===D(r.value)||r.type==="date"&&!n&&!r.value||n!==r.value&&(r.value=n??"")})}function B(r){var e=r.type;return e==="number"||e==="range"}function D(r){return r===""?null:+r}const st=100;var k;class xe{constructor(e){ae(this,k);P(this,"color");P(this,"x");P(this,"y");P(this,"length");P(this,"child");this.color=e.color||"green",this.x=e.x||0,this.y=e.y||0,this.child=e.child,this.length=e.length||st,ie(this,k,J(Ue(e.angle||Math.PI/4)))}get angle(){return b(X(this,k))}set angle(e){C(X(this,k),e,!0)}getEndPosition(){const e=this.x+this.length*Math.cos(this.angle),t=this.y-this.length*Math.sin(this.angle);return{x:e,y:t}}draw(e,t,s){this.x=e,this.y=t;const n=this.getEndPosition();s.strokeStyle="black",s.lineWidth=3,s.beginPath(),s.moveTo(this.x,this.y),s.lineTo(n.x,n.y),s.stroke(),s.beginPath(),s.arc((this.x+n.x)/2,(this.y+n.y)/2,10,0,Math.PI*2),s.fillStyle=this.color,s.fill(),s.beginPath(),s.arc(n.x,n.y,5,0,Math.PI*2),s.fillStyle="black",s.fill(),this.child&&this.child.draw(n.x,n.y,s)}arcPos(){const e=this.getEndPosition();return{x:(this.x+e.x)/2,y:(this.y+e.y)/2}}isInsideJoint(e){const t=this.arcPos(),s=e.x-t.x,n=e.y-t.y;return s*s+n*n<=10*10}}k=new WeakMap;function U(r,e){const t=r.getBoundingClientRect();return{x:e.clientX-t.left,y:e.clientY-t.top}}function N(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function R(r,e,t){const s=(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);return s===0?0:s>0?1:2}function nt(r,e,t,s){const n=R(r,e,t),a=R(r,e,s),i=R(t,s,r),c=R(t,s,e);return!!(n!==0&&a!==0&&i!==0&&c!==0&&n!==a&&i!==c||n===0&&N(r,t,e)||a===0&&N(r,s,e)||i===0&&N(t,r,s)||c===0&&N(t,e,s))}const j=6;class at{constructor(e){P(this,"vertices");this.vertices=e}draw(e,t,s){s.fillStyle="gray",s.beginPath(),s.moveTo(this.vertices[0].x+e,this.vertices[0].y+t);for(let n=1;n<this.vertices.length;n++)s.lineTo(this.vertices[n].x+e,this.vertices[n].y+t);s.closePath(),s.fill()}drawHandles(e,t,s){s.strokeStyle="rgba(0,0,255,0.5)",s.fillStyle="rgba(100,100,255,0.7)",s.lineWidth=1,this.vertices.forEach(n=>{const a=n.x+e,i=n.y+t;s.beginPath(),s.arc(a,i,j,0,Math.PI*2),s.fill(),s.stroke()})}pointerOnVertex(e,t){for(let s=0;s<this.vertices.length;s++){const n=this.vertices[s],a=n.x+t.x,i=n.y+t.y,c=e.x-a,v=e.y-i;if(c*c+v*v<=j*j)return{vertexIndex:s}}return null}pointInside(e,t){let s=!1;for(let n=0,a=this.vertices.length-1;n<this.vertices.length;a=n++){const i=this.vertices[n].x+t.x,c=this.vertices[n].y+t.y,v=this.vertices[a].x+t.x,p=this.vertices[a].y+t.y;c>e.y!=p>e.y&&e.x<(v-i)*(e.y-c)/(p-c)+i&&(s=!s)}return s}collidesWithSegment(e,t,s){const n=this.vertices.map(i=>({x:i.x+s.x,y:i.y+s.y}));if(n.length<2)return!1;for(let i=0;i<n.length;i++){const c=n[i],v=n[(i+1)%n.length];if(nt(e,t,c,v))return!0}const a={x:(e.x+t.x)/2,y:(e.y+t.y)/2};return!!(this.vertices.length>=3&&this.pointInside(a,s))}}var it=me('<div class="cspace_calc svelte-1b9rm3r">calculating C-Space...</div>'),ot=me('<div class="some_space svelte-1b9rm3r" style="margin-right: 20px;">Robot space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas></div> <div class="some_space svelte-1b9rm3r">configuration space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas> <!></div> <br> upper arm angle: <input type="range"> <button>0</button> <br> forearm angle: <input type="range"> <button>0</button> <br>',1);function ut(r,e){je(e,!0);let t,s,n,a,i,c=null,v=J(!0),p=!0,V=!1,x=J(void 0),g=new xe({length:80}),_=new xe({child:g,color:"blue"}),E=[new at([{x:20,y:20},{x:80,y:50},{x:50,y:80}])];function Ie(){!g||!_||!a||(a.clearRect(0,0,n.width,n.height),c&&a.putImageData(c,0,0),a.beginPath(),a.arc((_.angle+Math.PI)*n.width/(Math.PI*2),(g.angle+Math.PI)*n.height/(Math.PI*2),4,0,Math.PI*2),a.fillStyle="rgba(0,0,0,0)",a.strokeStyle="black",a.lineWidth=2,a.fill(),a.stroke())}function Me(){if(!s)return;s.clearRect(0,0,t.width,t.height);const o=t.width/2,f=t.height/2;E.forEach(l=>{s&&(l.draw(t.width/2,t.height/2,s),l.drawHandles(o,f,s))}),_.draw(t.width/2,t.height/2,s)}function A(){Me(),Ie()}function F(){if(!a||!p)return;console.log("Computing c-space obstacles..."),C(v,!0);const o=n.width,f=n.height;c=a.createImageData(o,f);const l=c.data,h={x:t.width/2,y:t.height/2},d=_.length,u=g.length,M=h;for(let L=0;L<f;L++){const z=L/f*(2*Math.PI)-Math.PI;for(let T=0;T<o;T++){const q=T/o*(2*Math.PI)-Math.PI,Ee=h,ee={x:h.x+d*Math.cos(q),y:h.y-d*Math.sin(q)},H=ee,Ce={x:H.x+u*Math.cos(z),y:H.y-u*Math.sin(z)};let te=!1;for(const re of E)if(re.collidesWithSegment(Ee,ee,M)||re.collidesWithSegment(H,Ce,M)){te=!0;break}const m=(L*o+T)*4;te?(l[m]=255,l[m+1]=100,l[m+2]=100,l[m+3]=200):(l[m]=0,l[m+1]=0,l[m+2]=0,l[m+3]=0)}}console.log("c-space obstacles done."),p=C(v,!1)}function Pe(){if(!(!n||!t)){if(s=t.getContext("2d"),a=n.getContext("2d"),!a||!s){console.error("Failed to get canvas contexts.");return}if(F(),!V){const o={x:t.width/2,y:t.height/2};t.addEventListener("pointerdown",f=>{const l=U(t,f);for(let h=0;h<E.length;h++){const d=E[h],u=d.pointerOnVertex(l,o);if(u){const M={x:d.vertices[u.vertexIndex].x+t.width/2,y:d.vertices[u.vertexIndex].y+t.height/2};C(x,{obstacleIndex:h,vertexIndex:u.vertexIndex,offsetX:l.x-M.x,offsetY:l.y-M.y},!0),i=void 0;return}}g.isInsideJoint(l)?i=g:_.isInsideJoint(l)&&(i=_)}),t.addEventListener("pointerup",()=>{b(x)&&(p=!0,F(),A(),C(x,void 0)),i=void 0}),t.addEventListener("pointermove",f=>{if(i){const h=U(t,f),d=h.x-i.x,u=h.y-i.y;i.angle=Math.atan2(-u,d),A();return}const l=U(t,f);if(b(x)){const h=E[b(x).obstacleIndex],d=b(x).vertexIndex,u=l.x-b(x).offsetX,M=l.y-b(x).offsetY;h.vertices[d].x=u-t.width/2,h.vertices[d].y=M-t.height/2,A()}}),V=!0}A()}}Je(Pe);var G=ot(),W=Oe(G),pe=y(he(W),3);ue(pe,o=>t=o,()=>t),fe(W);var Y=y(W,2),$=y(he(Y),3);ue($,o=>n=o,()=>n);var we=y($,2);{var Se=o=>{var f=it();oe(o,f)};Qe(we,o=>{b(v)&&o(Se)})}fe(Y);var w=y(Y,4);ge(w),I(w,"min",-Math.PI),I(w,"max",Math.PI),I(w,"step",.01);var K=y(w,2);K.__click=()=>{g.angle=0};var Q=y(K),S=y(Q,3);ge(S),I(S,"min",-Math.PI),I(S,"max",Math.PI),I(S,"step",.01);var Z=y(S,2);Z.__click=()=>{_.angle=0};var ke=y(Z);$e(),Fe((o,f)=>{de(Q,` ${o??""}`),de(ke,` ${f??""}`)},[()=>Math.round(g.angle*1800/Math.PI)/10,()=>Math.round(_.angle*1800/Math.PI)/10]),ye(w,()=>g.angle,o=>g.angle=o),ye(S,()=>_.angle,o=>_.angle=o),oe(r,G),Ge()}Ke(["click"]);export{ut as component};
