var Je=Object.defineProperty;var ue=r=>{throw TypeError(r)};var Ge=(r,t,e)=>t in r?Je(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var E=(r,t,e)=>Ge(r,typeof t!="symbol"?t+"":t,e),ve=(r,t,e)=>t.has(r)||ue("Cannot "+e);var K=(r,t,e)=>(ve(r,t,"read from private field"),e?e.call(r):t.get(r)),ge=(r,t,e)=>t.has(r)?ue("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(r):t.set(r,e),_e=(r,t,e,n)=>(ve(r,t,"write to private field"),n?n.call(r,e):t.set(r,e),e);import{t as ee,a as R,d as ye}from"../chunks/DuRY85xG.js";import{x as xe,y as me,A as $e,B as Ke,an as Qe,ao as Ze,ap as ze,h as te,aq as qe,ar as et,as as tt,g as rt,t as nt,Z as d,ac as _,ak as O,ab as Ce,P as st,u as at,f as be,a4 as u,a1 as we,Q as it,a2 as X,a3 as B,at as ot}from"../chunks/CYGJYrKH.js";import{d as lt,s as Q}from"../chunks/Dfdn6VkB.js";import{b as Pe,i as Z}from"../chunks/CstHgugv.js";let Ie=!1;function Te(){Ie||(Ie=!0,document.addEventListener("reset",r=>{Promise.resolve().then(()=>{var t;if(!r.defaultPrevented)for(const e of r.target.elements)(t=e.__on_r)==null||t.call(e)})},{capture:!0}))}function ct(r){var t=$e,e=Ke;xe(null),me(null);try{return r()}finally{xe(t),me(e)}}function ht(r,t,e,n=e){r.addEventListener(t,()=>ct(e));const s=r.__on_r;s?r.__on_r=()=>{s(),n(!0)}:r.__on_r=()=>n(!0),Te()}const dt=Symbol("is custom element"),ft=Symbol("is html");function Me(r){if(te){var t=!1,e=()=>{if(!t){if(t=!0,r.hasAttribute("value")){var n=r.value;I(r,"value",null),r.value=n}if(r.hasAttribute("checked")){var s=r.checked;I(r,"checked",null),r.checked=s}}};r.__on_r=e,et(e),Te()}}function I(r,t,e,n){var s=ut(r);te&&(s[t]=r.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&r.nodeName==="LINK")||s[t]!==(s[t]=e)&&(t==="loading"&&(r[Qe]=e),e==null?r.removeAttribute(t):typeof e!="string"&&vt(r).includes(t)?r[t]=e:r.setAttribute(t,e))}function ut(r){return r.__attributes??(r.__attributes={[dt]:r.nodeName.includes("-"),[ft]:r.namespaceURI===Ze})}var pe=new Map;function vt(r){var t=pe.get(r.nodeName);if(t)return t;pe.set(r.nodeName,t=[]);for(var e,n=r,s=Element.prototype;s!==n;){e=qe(n);for(var a in e)e[a].set&&t.push(a);n=ze(n)}return t}function Se(r,t,e=t){var n=tt();ht(r,"input",s=>{var a=s?r.defaultValue:r.value;if(a=z(r)?q(a):a,e(a),n&&a!==(a=t())){var o=r.selectionStart,l=r.selectionEnd;r.value=a??"",l!==null&&(r.selectionStart=o,r.selectionEnd=Math.min(l,r.value.length))}}),(te&&r.defaultValue!==r.value||rt(t)==null&&r.value)&&e(z(r)?q(r.value):r.value),nt(()=>{var s=t();z(r)&&s===q(r.value)||r.type==="date"&&!s&&!r.value||s!==r.value&&(r.value=s??"")})}function z(r){var t=r.type;return t==="number"||t==="range"}function q(r){return r===""?null:+r}const gt=100;var N;class ke{constructor(t){ge(this,N);E(this,"color");E(this,"x");E(this,"y");E(this,"length");E(this,"child");this.color=t.color||"green",this.x=t.x||0,this.y=t.y||0,this.child=t.child,this.length=t.length||gt,_e(this,N,O(Ce(t.angle||Math.PI/4)))}get angle(){return d(K(this,N))}set angle(t){_(K(this,N),t,!0)}getEndPosition(){const t=this.x+this.length*Math.cos(this.angle),e=this.y-this.length*Math.sin(this.angle);return{x:t,y:e}}draw(t,e,n){this.x=t,this.y=e;const s=this.getEndPosition();n.strokeStyle="black",n.lineWidth=3,n.beginPath(),n.moveTo(this.x,this.y),n.lineTo(s.x,s.y),n.stroke(),n.beginPath(),n.arc((this.x+s.x)/2,(this.y+s.y)/2,10,0,Math.PI*2),n.fillStyle=this.color,n.fill(),n.beginPath(),n.arc(s.x,s.y,5,0,Math.PI*2),n.fillStyle="black",n.fill(),this.child&&this.child.draw(s.x,s.y,n)}arcPos(){const t=this.getEndPosition();return{x:(this.x+t.x)/2,y:(this.y+t.y)/2}}isInsideJoint(t){const e=this.arcPos(),n=t.x-e.x,s=t.y-e.y;return n*n+s*s<=10*10}}N=new WeakMap;function U(r,t){const e=r.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}function _t(r,t){const e=U(r,t);return e.x-=r.width/2,e.y-=r.height/2,e}function H(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function D(r,t,e){const n=(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y);return n===0?0:n>0?1:2}function yt(r,t,e,n){const s=D(r,t,e),a=D(r,t,n),o=D(e,n,r),l=D(e,n,t);return!!(s!==0&&a!==0&&o!==0&&l!==0&&s!==a&&o!==l||s===0&&H(r,e,t)||a===0&&H(r,n,t)||o===0&&H(e,r,n)||l===0&&H(e,t,n))}const M=6;class Ee{constructor(t){E(this,"vertices");this.vertices=t}draw(t,e){e.fillStyle="gray",e.beginPath(),e.moveTo(this.vertices[0].x+t.x,this.vertices[0].y+t.x);for(let n=1;n<this.vertices.length;n++)e.lineTo(this.vertices[n].x+t.x,this.vertices[n].y+t.y);e.closePath(),e.fill()}drawHandles(t,e){e.strokeStyle="rgba(0,0,255,0.5)",e.fillStyle="rgba(100,100,255,0.7)",e.lineWidth=1,this.vertices.forEach(n=>{const s=n.x+t.x,a=n.y+t.y;e.beginPath(),e.arc(s,a,M,0,Math.PI*2),e.fill(),e.stroke()})}pointerOnVertex(t,e){for(let n=0;n<this.vertices.length;n++){const s=this.vertices[n],a=s.x+e.x,o=s.y+e.y,l=t.x-a,y=t.y-o;if(l*l+y*y<=M*M)return{vertexIndex:n}}return null}pointInside(t,e){let n=!1;for(let s=0,a=this.vertices.length-1;s<this.vertices.length;a=s++){const o=this.vertices[s].x+e.x,l=this.vertices[s].y+e.y,y=this.vertices[a].x+e.x,p=this.vertices[a].y+e.y;l>t.y!=p>t.y&&t.x<(y-o)*(t.y-l)/(p-l)+o&&(n=!n)}return n}collidesWithSegment(t,e,n){const s=this.vertices.map(o=>({x:o.x+n.x,y:o.y+n.y}));if(s.length<2)return!1;for(let o=0;o<s.length;o++){const l=s[o],y=s[(o+1)%s.length];if(yt(t,e,l,y))return!0}const a={x:(t.x+e.x)/2,y:(t.y+e.y)/2};return!!(this.vertices.length>=3&&this.pointInside(a,n))}}function xt(r,t,e){if(r.length<=0)return;e.fillStyle="rgba(255, 0, 0, 0.3)",e.strokeStyle="rgba(255, 0, 0, 0.7)",e.lineWidth=2,e.beginPath();const n={x:r[0].x+t.x,y:r[0].y+t.y};e.moveTo(n.x,n.y),e.arc(n.x,n.y,M,0,Math.PI*2);for(let s=1;s<r.length;s++){const a=r[s],o=a.x+t.x,l=a.y+t.y;e.lineTo(o,l),e.moveTo(o+M,l),e.arc(o,l,M,0,Math.PI*2),e.moveTo(o,l)}r.length>2&&e.lineTo(n.x,n.y),e.stroke(),e.beginPath(),r.forEach(s=>{const a=s.x+t.x,o=s.y+t.y;e.moveTo(a+M,o),e.arc(a,o,M,0,Math.PI*2)}),e.fill()}var mt=ee('<div class="cspace_calc svelte-1b9rm3r">calculating C-Space...</div>'),bt=ee("<button> </button> <p>Click on Robot Space to add points to the new obstacle.</p>",1),wt=ee('<div class="some_space svelte-1b9rm3r" style="margin-right: 20px;">Robot space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas></div> <div class="some_space svelte-1b9rm3r">configuration space<br> <canvas width="500" height="500" class="svelte-1b9rm3r"></canvas> <!></div> <br> upper arm angle: <input type="range"> <button>0</button> <br> forearm angle: <input type="range"> <button>0</button> <br> <button><!></button> <!>',1);function kt(r,t){st(t,!0);let e,n,s,a,o,l=null,y=O(!0),p=!0,j=!1,m=O(!1),S=O(Ce([])),x=O(void 0),b=new ke({length:80}),w=new ke({child:b,color:"blue"}),C=[new Ee([{x:20,y:20},{x:80,y:50},{x:50,y:80}])];function Ae(){a&&(a.clearRect(0,0,s.width,s.height),l&&a.putImageData(l,0,0),a.beginPath(),a.arc((w.angle+Math.PI)*s.width/(Math.PI*2),(b.angle+Math.PI)*s.height/(Math.PI*2),4,0,Math.PI*2),a.fillStyle="rgba(0,0,0,0)",a.strokeStyle="black",a.lineWidth=2,a.fill(),a.stroke())}function Le(){if(!n)return;n.clearRect(0,0,e.width,e.height);const i={x:e.width/2,y:e.height/2};C.forEach(c=>{n&&(c.draw(i,n),d(m)||c.drawHandles(i,n))}),d(m)&&xt(d(S),i,n),w.draw(e.width/2,e.height/2,n)}function T(){Le(),Ae()}function F(){if(!a||!p)return;console.log("Computing c-space obstacles..."),_(y,!0);const i=s.width,c=s.height;l=a.createImageData(i,c);const h=l.data,f={x:e.width/2,y:e.height/2},v=w.length,g=b.length,k=f;for(let Y=0;Y<c;Y++){const le=Y/c*(2*Math.PI)-Math.PI;for(let V=0;V<i;V++){const ce=V/i*(2*Math.PI)-Math.PI,je=f,he={x:f.x+v*Math.cos(ce),y:f.y-v*Math.sin(ce)},$=he,Fe={x:$.x+g*Math.cos(le),y:$.y-g*Math.sin(le)};let de=!1;for(const fe of C)if(fe.collidesWithSegment(je,he,k)||fe.collidesWithSegment($,Fe,k)){de=!0;break}const P=(Y*i+V)*4;de?(h[P]=255,h[P+1]=100,h[P+2]=100,h[P+3]=200):(h[P]=0,h[P+1]=0,h[P+2]=0,h[P+3]=0)}}console.log("c-space obstacles done."),p=_(y,!1)}function Ne(){_(m,!d(m)),d(m)&&(_(S,[],!0),o=void 0,_(x,void 0))}function Re(){const i=new Ee([...d(S)]);C.push(i),_(S,[],!0),_(m,!1),p=!0,F(),T(),_(x,void 0)}function Oe(){if(!(!s||!e)){if(n=e.getContext("2d"),a=s.getContext("2d"),!a||!n){console.error("Failed to get canvas contexts.");return}if(F(),!j){const i={x:e.width/2,y:e.height/2};e.addEventListener("pointerdown",c=>{const h=U(e,c);for(let f=0;f<C.length;f++){const v=C[f],g=v.pointerOnVertex(h,i);if(g){const k={x:v.vertices[g.vertexIndex].x+e.width/2,y:v.vertices[g.vertexIndex].y+e.height/2};_(x,{obstacleIndex:f,vertexIndex:g.vertexIndex,offsetX:h.x-k.x,offsetY:h.y-k.y},!0),o=void 0;return}}b.isInsideJoint(h)?o=b:w.isInsideJoint(h)&&(o=w)}),e.addEventListener("pointerup",()=>{d(x)&&(p=!0,F(),T(),_(x,void 0)),o=void 0}),e.addEventListener("click",c=>{if(d(m)&&e){const h=_t(e,c);d(S).push(h),T()}}),e.addEventListener("pointermove",c=>{if(o){const f=U(e,c),v=f.x-o.x,g=f.y-o.y;o.angle=Math.atan2(-g,v),T();return}const h=U(e,c);if(d(x)){const f=C[d(x).obstacleIndex],v=d(x).vertexIndex,g=h.x-d(x).offsetX,k=h.y-d(x).offsetY;f.vertices[v].x=g-e.width/2,f.vertices[v].y=k-e.height/2,T()}}),j=!0}T()}}at(Oe);var re=wt(),J=be(re),We=u(X(J),3);Pe(We,i=>e=i,()=>e),B(J);var G=u(J,2),ne=u(X(G),3);Pe(ne,i=>s=i,()=>s);var Ye=u(ne,2);{var Ve=i=>{var c=mt();R(i,c)};Z(Ye,i=>{d(y)&&i(Ve)})}B(G);var A=u(G,4);Me(A),I(A,"min",-Math.PI),I(A,"max",Math.PI),I(A,"step",.01);var se=u(A,2);se.__click=()=>{b.angle=0};var ae=u(se),L=u(ae,3);Me(L),I(L,"min",-Math.PI),I(L,"max",Math.PI),I(L,"step",.01);var ie=u(L,2);ie.__click=()=>{w.angle=0};var oe=u(ie),W=u(oe,3);W.__click=Ne;var Xe=X(W);{var Be=i=>{var c=ye("Cancel");R(i,c)},He=i=>{var c=ye("Add New Obstacle");R(i,c)};Z(Xe,i=>{d(m)?i(Be):i(He,!1)})}B(W);var De=u(W,2);{var Ue=i=>{var c=bt(),h=be(c);h.__click=Re;var f=X(h);B(h),ot(2),we(()=>{h.disabled=d(S).length<3,Q(f,`Finish Obstacle (${d(S).length??""} points)`)}),R(i,c)};Z(De,i=>{d(m)&&i(Ue)})}we((i,c)=>{Q(ae,` ${i??""}`),Q(oe,` ${c??""}`)},[()=>Math.round(b.angle*1800/Math.PI)/10,()=>Math.round(w.angle*1800/Math.PI)/10]),Se(A,()=>b.angle,i=>b.angle=i),Se(L,()=>w.angle,i=>w.angle=i),R(r,re),it()}lt(["click"]);export{kt as component};
